<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>POWER CALIBRATION</title>

<style>
@font-face {
  font-family: "RE4";
  src: url("./resident_evil_4_remake_font_by_snakeyboy_df7kacs.ttf");
}

body {
  margin: 0;
  background: #050807;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: "RE4", monospace;
}

#panel {
  border: 4px solid #1aff9c;
  padding: 12px;
  background: #03130c;
}

canvas {
  background: #000;
  display: block;
}

#status {
  margin-top: 6px;
  color: #1aff9c;
  font-size: 14px;
  text-align: center;
}
</style>
</head>

<body>
<div id="panel">
  <canvas id="game" width="460" height="460"></canvas>
  <div id="status">INSUFFICIENT POWER. CALIBRATION REQUIRED.</div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const statusText = document.getElementById("status");

const CENTER = 230;

// ===== Junction 狀態 =====
// 0 = L
// 1 = T
// 2 = +
let junctions = [
  { x: CENTER, y: 110, type: 0 },
  { x: CENTER, y: 230, type: 1 },
  { x: CENTER, y: 350, type: 0 }
];

// 三個電源點（在不同電圈）
let powerNodes = [
  { x: CENTER + 120, y: 110, powered: false },
  { x: CENTER + 160, y: 230, powered: false },
  { x: CENTER + 200, y: 350, powered: false }
];

function drawLoop(size) {
  ctx.strokeStyle = "#1aff9c";
  ctx.lineWidth = 3;
  ctx.strokeRect(
    CENTER - size,
    CENTER - size,
    size * 2,
    size * 2
  );
}

function drawJunction(j) {
  ctx.strokeStyle = "#1aff9c";
  ctx.lineWidth = 4;
  ctx.beginPath();

  if (j.type === 0) { // L
    ctx.moveTo(j.x, j.y);
    ctx.lineTo(j.x + 30, j.y);
    ctx.moveTo(j.x, j.y);
    ctx.lineTo(j.x, j.y + 30);
  } else if (j.type === 1) { // T
    ctx.moveTo(j.x - 20, j.y);
    ctx.lineTo(j.x + 20, j.y);
    ctx.moveTo(j.x, j.y);
    ctx.lineTo(j.x, j.y + 30);
  } else { // +
    ctx.moveTo(j.x - 20, j.y);
    ctx.lineTo(j.x + 20, j.y);
    ctx.moveTo(j.x, j.y - 20);
    ctx.lineTo(j.x, j.y + 20);
  }

  ctx.stroke();
}

function drawPowerNode(p) {
  ctx.fillStyle = p.powered ? "#1aff9c" : "#064b30";
  ctx.beginPath();
  ctx.arc(p.x, p.y, 6, 0, Math.PI * 2);
  ctx.fill();
}

function evaluatePower() {
  // 電力從上方進來
  let flow = true;

  junctions.forEach((j, i) => {
    if (j.type === 0 && i === 1) flow = false;
    if (j.type === 1 && i === 2) flow = false;
    powerNodes[i].powered = flow;
  });

  const success = powerNodes.every(p => p.powered);
  statusText.textContent = success
    ? "POWER STABLE. ALL LOOPS ONLINE."
    : "INSUFFICIENT POWER. CALIBRATION REQUIRED.";
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // POWER label
  ctx.fillStyle = "#1aff9c";
  ctx.font = "14px RE4";
  ctx.fillText("POWER ++", CENTER - 40, 40);

  // 電圈
  drawLoop(80);
  drawLoop(120);
  drawLoop(160);

  junctions.forEach(drawJunction);
  powerNodes.forEach(drawPowerNode);
}

canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;

  junctions.forEach(j => {
    if (Math.abs(mx - j.x) < 25 && Math.abs(my - j.y) < 25) {
      j.type = (j.type + 1) % 3;
      evaluatePower();
      draw();
    }
  });
});

evaluatePower();
draw();
</script>
</body>
</html>
