<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCB REPAIR TERMINAL</title>
    <style>
        :root { --green: #00ff66; --dark-green: #002200; --gold: #ffcc00; --bg: #0a0a0a; }
        body { background: var(--bg); color: var(--green); font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; margin: 0; }
        
        #board-container { 
            position: relative; width: 360px; height: 480px; 
            background: #111; border: 4px solid #333; margin-top: 20px;
            background-image: radial-gradient(#1a1a1a 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* 導軌（電路路徑） */
        .trace { position: absolute; background: #222; transition: 0.3s; }
        .trace.active { background: var(--green); box-shadow: 0 0 10px var(--green); }

        /* 元件按鈕 */
        .component {
            position: absolute; width: 40px; height: 40px;
            background: #000; border: 1px solid #444; cursor: pointer;
            display: flex; justify-content: center; align-items: center; z-index: 10;
        }
        .component svg { width: 30px; height: 30px; stroke: #333; stroke-width: 4; fill: none; }
        .component.powered svg { stroke: var(--green); filter: drop-shadow(0 0 5px var(--green)); }
        .component.powered { border-color: var(--green); }

        /* 電源目標點 */
        .node {
            position: absolute; width: 20px; height: 20px;
            border: 2px solid #333; border-radius: 50%; z-index: 5;
            background: #000; display: flex; justify-content: center; align-items: center;
        }
        .node.active { background: var(--green); border-color: #fff; box-shadow: 0 0 15px var(--green); }
        .node::after { content: '⚡'; font-size: 10px; color: #333; }
        .node.active::after { color: #000; }

        .header { width: 360px; padding: 10px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--dark-green); }
        .status { font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>

<div class="header">
    <div>SYSTEM: <span style="color:var(--gold)">REPAIR MODE</span></div>
    <div class="status" id="progress">NODES: 0 / 4</div>
</div>

<div id="board-container">
    <div style="position:absolute; left:-10px; top:40px; background:var(--green); color:#000; padding:2px 5px; font-size:10px; z-index:20;">POWER IN</div>
</div>

<script>
const container = document.getElementById('board-container');
let components = [];
let targetNodes = [];

// 定義組件類型
const TYPES = {
    L: '<path d="M20 0 V20 H40" />',
    T: '<path d="M0 20 H40 M20 20 V0" />',
    BRIDGE: '<path d="M20 0 V15 M20 25 V40 M0 20 H40" />' // 交叉不相連
};

const stage = [
    { x: 40, y: 40, type: 'T', rot: 0, connectTo: [1, 2] },     // 0: 入口分流
    { x: 40, y: 200, type: 'L', rot: 90, connectTo: [4] },     // 1: 左路轉向
    { x: 280, y: 40, type: 'L', rot: 0, connectTo: [3] },      // 2: 右路轉向
    { x: 280, y: 200, type: 'BRIDGE', rot: 0, connectTo: [5] } // 3: 交叉隔離
];

const nodes = [
    { x: 180, y: 40, parent: 0 },  // 目標 1
    { x: 40, y: 350, parent: 1 },  // 目標 2
    { x: 280, y: 350, parent: 3 }, // 目標 3
    { x: 180, y: 200, parent: 3 }  // 目標 4
];

function init() {
    // 生成組件
    stage.forEach((data, i) => {
        const div = document.createElement('div');
        div.className = 'component';
        div.style.left = data.x + 'px';
        div.style.top = data.y + 'px';
        div.style.transform = `rotate(${data.rot}deg)`;
        div.innerHTML = `<svg viewBox="0 0 40 40">${TYPES[data.type]}</svg>`;
        
        div.onclick = () => {
            data.rot = (data.rot + 90) % 360;
            div.style.transform = `rotate(${data.rot}deg)`;
            updateCircuit();
        };
        data.el = div;
        components.push(data);
        container.appendChild(div);
    });

    // 生成目標電源
    nodes.forEach((data, i) => {
        const div = document.createElement('div');
        div.className = 'node';
        div.style.left = data.x + 'px';
        div.style.top = data.y + 'px';
        data.el = div;
        targetNodes.push(data);
        container.appendChild(div);
    });

    updateCircuit();
}

function updateCircuit() {
    // 模擬電力傳導：這是一個簡化的「方向判定」
    // 只有當 T 型開口朝右 (90) 或下 (180) 時，電力才會向外傳
    let p = [false, false, false, false];
    
    // 第一顆 T 型元件
    const c0 = components[0];
    c0.powered = true; // 入口始終有電
    
    if(c0.rot === 90 || c0.rot === 180) { // 向右或向下通電
        targetNodes[0].active = true;
        components[2].powered = true;
    } else {
        targetNodes[0].active = false;
        components[2].powered = false;
    }

    if(c0.rot === 180 || c0.rot === 270) { // 向下或向左通電
        components[1].powered = true;
    } else {
        components[1].powered = false;
    }

    // 更新視覺
    components.forEach(c => c.el.classList.toggle('powered', c.powered));
    
    let activeCount = 0;
    targetNodes.forEach(n => {
        // 只有父組件通電，電源才亮
        n.active = components[n.parent].powered;
        n.el.classList.toggle('active', n.active);
        if(n.active) activeCount++;
    });

    document.getElementById('progress').innerText = `NODES: ${activeCount} / 4`;
}

init();
</script>

</body>
</html>


