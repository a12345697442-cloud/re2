<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RE4 CIRCUIT OVERRIDE</title>
    <style>
        :root {
            --re-green: #3cf08d;
            --re-dim: #163a24;
            --bg-black: #050806;
        }

        body {
            background-color: var(--bg-black);
            color: var(--re-green);
            font-family: 'Courier New', monospace;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 0; height: 100vh; overflow: hidden;
            background-image: radial-gradient(circle, #0d1a12 0%, #000 100%);
            user-select: none;
        }

        .status-header {
            width: 320px; display: flex; justify-content: space-between;
            margin-top: 30px; font-size: 14px; letter-spacing: 2px;
        }

        /* 終端螢幕區 */
        #terminal-screen {
            width: 350px; height: 350px;
            margin-top: 40px; position: relative;
            background: rgba(0, 15, 8, 0.5);
            border: 1px solid var(--re-dim);
        }

        /* 背景網格線 */
        .grid-line {
            position: absolute; border: 1px dashed rgba(26, 74, 46, 0.3);
            pointer-events: none;
        }

        /* 符號元件 - 點擊區域大於視覺符號以方便手機操作 */
        .node {
            position: absolute; width: 60px; height: 60px;
            display: flex; justify-content: center; align-items: center;
            z-index: 100; cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            -webkit-tap-highlight-color: transparent;
        }

        .node-symbol {
            font-size: 32px; color: var(--re-dim);
            transition: color 0.3s, text-shadow 0.3s;
        }

        .node.powered .node-symbol {
            color: var(--re-green);
            text-shadow: 0 0 15px var(--re-green);
        }

        /* 中心電源與目標點 */
        .core {
            position: absolute; top: 155px; left: 155px; width: 40px; height: 40px;
            background: #fff; border-radius: 50%; z-index: 110;
            box-shadow: 0 0 20px #fff; display: flex; justify-content: center; align-items: center;
            color: #000; font-weight: bold; font-size: 20px;
        }

        .target {
            position: absolute; width: 20px; height: 20px;
            border: 2px solid var(--re-dim); border-radius: 50%;
            z-index: 50; transition: 0.3s;
        }
        .target.lit {
            background: var(--re-green); border-color: #fff;
            box-shadow: 0 0 20px var(--re-green);
        }

        #circuit-canvas { position: absolute; top: 0; left: 0; z-index: 10; pointer-events: none; }

        .instruction {
            margin-top: 50px; color: var(--re-dim); font-size: 12px;
            text-align: center; letter-spacing: 1px; line-height: 1.5;
        }
    </style>
</head>
<body>

    <div class="status-header">
        <div style="border: 1px solid var(--re-green); padding: 2px 8px;">POWER >></div>
        <div id="counter">ACCESS: 0 / 4</div>
    </div>

    <div id="terminal-screen">
        <canvas id="circuit-canvas" width="350" height="350"></canvas>
        <div class="core">◎</div>
        </div>

    <div class="instruction">
        TAP THE CONNECTORS TO RE-ROUTE POWER<br>
        ACTIVATE ALL TARGET NODES TO UNLOCK
    </div>

<script>
    const screen = document.getElementById('terminal-screen');
    const canvas = document.getElementById('circuit-canvas');
    const ctx = canvas.getContext('2d');
    
    // 定義符號位置與目標
    const nodeData = [
        { id: 1, r: 1, dir: 'N', type: '┳', rot: 0 },
        { id: 2, r: 1, dir: 'S', type: '┗', rot: 90 },
        { id: 3, r: 2, dir: 'W', type: '┣', rot: 180 },
        { id: 4, r: 2, dir: 'E', type: '┛', rot: 270 },
        { id: 5, r: 3, dir: 'N', type: '┻', rot: 0 },
        { id: 6, r: 3, dir: 'S', type: '┳', rot: 90 }
    ];

    const targets = [
        { x: 175, y: 30,  lit: false },
        { x: 320, y: 175, lit: false },
        { x: 175, y: 320, lit: false },
        { x: 30,  y: 175, lit: false }
    ];

    function init() {
        // 生成目標
        targets.forEach((t, i) => {
            const el = document.createElement('div');
            el.className = 'target';
            el.id = `target-${i}`;
            el.style.left = (t.x - 10) + 'px';
            el.style.top = (t.y - 10) + 'px';
            screen.appendChild(el);
        });

        // 生成符號按鈕
        nodeData.forEach(data => {
            const btn = document.createElement('div');
            btn.className = 'node';
            
            // 計算佈局位置
            let x = 145, y = 145;
            const dist = data.r * 45;
            if(data.dir === 'N') y -= dist;
            if(data.dir === 'S') y += dist;
            if(data.dir === 'W') x -= dist;
            if(data.dir === 'E') x += dist;

            btn.style.left = x + 'px';
            btn.style.top = y + 'px';
            
            const symbol = document.createElement('span');
            symbol.className = 'node-symbol';
            symbol.innerHTML = data.type;
            btn.appendChild(symbol);
            
            // 隨機初始旋轉
            data.rot = Math.floor(Math.random() * 4) * 90;
            btn.style.transform = `rotate(${data.rot}deg)`;

            // 直接點擊符號旋轉
            btn.addEventListener('click', () => rotateNode(data, btn));
            
            screen.appendChild(btn);
            data.el = btn;
        });

        animate();
    }

    function rotateNode(data, el) {
        data.rot += 90;
        el.style.transform = `rotate(${data.rot}deg)`;
        if (window.navigator.vibrate) window.navigator.vibrate(25);
        checkPower();
    }

    function checkPower() {
        // 核心解謎邏輯：判斷哪些目標被接通
        // 這裡設定特定的旋轉組合為通電條件（可根據 1.jpg 的路徑自定義）
        let litCount = 0;
        
        targets.forEach((t, i) => {
            // 模擬：如果對應軸線上的符號轉到 0 或 180 度，則通電
            const isLit = nodeData.some(n => n.r > 0 && n.rot % 360 === 0); 
            // 這裡可以根據具體需求鎖定每個點的解答
            t.lit = isLit; 
            document.getElementById(`target-${i}`).classList.toggle('lit', t.lit);
            if(t.lit) litCount++;
        });

        document.getElementById('counter').innerText = `ACCESS: ${litCount} / 4`;
    }

    function animate() {
        ctx.clearRect(0, 0, 350, 350);
        
        // 繪製發光的電力傳導線
        ctx.lineWidth = 2;
        ctx.shadowBlur = 8;
        ctx.shadowColor = '#3cf08d';
        ctx.strokeStyle = '#163a24';

        // 繪製十字主幹
        ctx.beginPath();
        ctx.moveTo(175, 30); ctx.lineTo(175, 320);
        ctx.moveTo(30, 175); ctx.lineTo(320, 175);
        ctx.stroke();

        // 動態電流效果
        const time = Date.now() / 400;
        ctx.strokeStyle = '#3cf08d';
        ctx.setLineDash([15, 10]);
        ctx.lineDashOffset = -time * 30;

        nodeData.forEach(n => {
            if(n.rot % 360 === 0) { // 通電狀態視覺
                n.el.classList.add('powered');
                ctx.beginPath();
                ctx.moveTo(175, 175);
                ctx.lineTo(parseInt(n.el.style.left)+30, parseInt(n.el.style.top)+30);
                ctx.stroke();
            } else {
                n.el.classList.remove('powered');
            }
        });

        requestAnimationFrame(animate);
    }

    init();
</script>
</body>
</html>
